!function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t){class s{set HTML(e){this._HTML=e}get HTML(){return this._HTML}}class n extends s{constructor(e,t){super(),this.queue=[],this.stopQueueFlag=!1,this.selectorClass="floor",this.number=e,this.maxFloor=t,this.generateQueue=this.generateQueue.bind(this),this.buildHTML(),this.enqueuePassenger=this.enqueuePassenger.bind(this),this.getRandomQueuer=this.getRandomQueuer.bind(this)}setQueue(e){this.queue=e,this.HTML.innerHTML="",this.queue.map(e=>{const t=this.getPassengerHTML(e.boundTo);this.HTML.appendChild(t)})}generateQueue(e){let{queue:t,stopQueueFlag:s,generateQueue:n,getRandomQueuer:i,enqueuePassenger:o}=this;setTimeout(()=>{o(i(),e),s||n(e)},2e4*Math.random())}dequeuePassenger(e){this.HTML.removeChild(this.queue[e].HTML),this.queue.splice(e,1)}enqueuePassenger(e,t){this.queue.push(e),e.HTML=this.getPassengerHTML(e.boundTo),this.HTML.appendChild(e.HTML),t().call(this.number,e.boundTo)}getPassengerHTML(e){const t=document.createElement("div");return t.classList.add("passenger"),t.innerHTML=e,t}getRandomQueuer(){const e=Math.round(Math.random()*(this.maxFloor-1));return e!==this.number?{boundTo:e}:this.getRandomQueuer()}buildHTML(){this.HTML=document.createElement("div"),this.HTML.classList.add(this.selectorClass),this.HTML.innerHTML=this.number}}class i extends s{constructor(e){super(),this.capacity=6,this.occupants=[],this.speed=900,this.queue=[],this.newQueue=[0],this.currentFloor=0,this.onMove=!1,this.HTML=document.createElement("div"),this.HTML.classList.add("elevator"),this.uponArrival=this.uponArrival.bind(this),this.building=e,this.HTML.addEventListener("transitionend",e=>{this.uponArrival()})}get nextFloor(){if(this.queue[0]&&"number"==typeof this.queue[0][0])return this.queue[0][0]}moveTo(e){let{speed:t,nextFloor:s}=this;const n=t*Math.abs(this.currentFloor-e);0===n?this.uponArrival():(this.HTML.style.transitionDuration=n+"ms",this.HTML.style.bottom=this.HTML.getBoundingClientRect().height*e+"px"),!1===this.onMove&&(this.onMove=!0)}unLoad(e){const t=[];let s=document.createDocumentFragment();return this.occupants=this.occupants.reduce((n,i)=>(i.boundTo===e?t.push(i):(n.push(i),s.appendChild(i.HTML)),n),[]),this.HTML.innerHTML="",this.HTML.appendChild(s),t}load(e){const t=this.capacity-this.occupants.length,s=[];let n=e.reduce((e,n)=>(e.length<t&&this.queue[0].indexOf(n.boundTo)>=0?(e.push(n),this.HTML.appendChild(n.HTML)):s.push(n),e),[]);return this.occupants=[...this.occupants,...n],s}uponArrival(){this.currentFloor=this.nextFloor;const e=this.building.floors[this.currentFloor];this.queue[0].shift(),this.queue[0].length||this.queue.shift();this.unLoad(this.currentFloor);if("number"!=typeof this.nextFloor)return void(this.onMove=!1);const t=this.load(e.queue);e.setQueue(t),this.moveTo(this.nextFloor)}call(e,t){let s=e>t;for(let n=0;n<this.queue.length;n++){let i=[...this.queue[n]];if(i[0]>i[1]===s){if(0===n&&(!1===s&&e<i[0]||!0===s&&e>i[0]))continue;i=[...i,t,e].reduce((e,t)=>(e.indexOf(t)<0&&e.push(t),e),[]).sort(),!0===s&&(i=i.reverse()),this.queue[n]=i,s=void 0;break}}void 0!==s&&this.queue.push([e,t]),!1===this.onMove&&this.moveTo(this.nextFloor)}}const o=new class extends s{constructor({floorsCount:e,container:t}){super(),this.floors=[];let s=new Array(e);s.fill(0).map((e,t)=>{this.floors.push(new n(t,s.length))}),this.elevator=new i(this),this.container=t,this.elevatorManager=this.elevatorManager.bind(this),this.build(),this.deploy()}elevatorManager(){return this.elevator}build(){this.HTML=document.createElement("div"),this.HTML.classList.add("building"),this.HTML.id="building",this.floors.map(e=>{e.generateQueue(this.elevatorManager),this.HTML.appendChild(e.HTML)}),this.HTML.appendChild(this.elevator.HTML)}deploy(){this.container.appendChild(this.HTML)}}({floorsCount:10,container:document.getElementById("container")});o.deploy(),console.log(o)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiSFRNTFJlcHJlc2VudGFibGUiLCJIVE1MIiwidGhpcyIsIl9IVE1MIiwiRmxvb3IiLCJudW1iZXIiLCJtYXhGbG9vciIsInN1cGVyIiwicXVldWUiLCJzdG9wUXVldWVGbGFnIiwic2VsZWN0b3JDbGFzcyIsImdlbmVyYXRlUXVldWUiLCJidWlsZEhUTUwiLCJlbnF1ZXVlUGFzc2VuZ2VyIiwiZ2V0UmFuZG9tUXVldWVyIiwibmV3UXVldWUiLCJpbm5lckhUTUwiLCJtYXAiLCJuZXdQYXNzZW5nZXJIVE1MIiwiZ2V0UGFzc2VuZ2VySFRNTCIsImJvdW5kVG8iLCJhcHBlbmRDaGlsZCIsImVsZXZhdG9yTWFuYWdlciIsInNldFRpbWVvdXQiLCJNYXRoIiwicmFuZG9tIiwicmVtb3ZlQ2hpbGQiLCJzcGxpY2UiLCJwYXNzZW5nZXIiLCJwdXNoIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyb3VuZCIsIkVsZXZhdG9yIiwiYnVpbGRpbmciLCJjYXBhY2l0eSIsIm9jY3VwYW50cyIsInNwZWVkIiwiY3VycmVudEZsb29yIiwib25Nb3ZlIiwidXBvbkFycml2YWwiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImZsb29ySWQiLCJuZXh0Rmxvb3IiLCJ0aW1lIiwiYWJzIiwic3R5bGUiLCJ0cmFuc2l0aW9uRHVyYXRpb24iLCJib3R0b20iLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJoZWlnaHQiLCJ1bmxvYWRlZCIsImZyYWciLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwicmVkdWNlIiwiYWNjIiwiZnJlZVNwb3RzIiwibGVuZ3RoIiwibG9zZXJzIiwiY29tZXJzIiwiaW5kZXhPZiIsImZsb29yIiwiZmxvb3JzIiwic2hpZnQiLCJ1bkxvYWQiLCJsb2FkIiwic2V0UXVldWUiLCJtb3ZlVG8iLCJmcm9tIiwidG8iLCJkaXJlY3Rpb24iLCJzdWJxdWUiLCJzb3J0IiwicmV2ZXJzZSIsInVuZGVmaW5lZCIsImZsb29yc0NvdW50IiwiY29udGFpbmVyIiwiQXJyYXkiLCJmaWxsIiwiZWxldmF0b3IiLCJidWlsZCIsImRlcGxveSIsImlkIiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zb2xlIiwibG9nIl0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVos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QWdCOUIsS0FBS1UsTUFFakRBLEtBQUtrRixRQUNMbEYsS0FBS21GLFNBckJOLGtCQUNDLE9BQU9uRixLQUFLaUYsU0F1QmIsUUFDQ2pGLEtBQUtELEtBQU84QixTQUFTQyxjQUFjLE9BQ25DOUIsS0FBS0QsS0FBS2dDLFVBQVVDLElBQUksWUFDeEJoQyxLQUFLRCxLQUFLcUYsR0FBSyxXQUVmcEYsS0FBS2dFLE9BQU9qRCxJQUFLZ0QsSUFDaEJBLEVBQU10RCxjQUFjVCxLQUFLb0IsaUJBQ3pCcEIsS0FBS0QsS0FBS29CLFlBQVk0QyxFQUFNaEUsUUFHN0JDLEtBQUtELEtBQUtvQixZQUFZbkIsS0FBS2lGLFNBQVNsRixNQUdyQyxTQUNDQyxLQUFLOEUsVUFBVTNELFlBQVluQixLQUFLRCxRQUlKLENBQzdCOEUsWUFBYSxHQUNiQyxVQUFXakQsU0FBU3dELGVBQWUsZUFHcENsRCxFQUFTZ0QsU0FDVEcsUUFBUUMsSUFBSXBEIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsIi8qXG5cbkNyZWF0ZTpcbkVsZXZhdG9yIENsYXNzIDogaW50ZXJmYWNlIGdyYXBoaWMgZW50aXR5XG5RdWV1ZS9GbG9vciBDbGFzcyA6IGludGVyZmFjZSBncmFwaGljIGVudGl0eVxuUGFzc2VuZ2VyIENsYXNzIC8gSW50ZXJmYWNlIDogaW50ZXJmYWNlIGdyYXBoaWMgZW50aXR5XG5FbGV2YXRvciBjb250cm9sbGVyXG5cbiovXG5cbmludGVyZmFjZSBQYXNzZW5nZXIge1xuXHRib3VuZFRvOiBudW1iZXJcblx0SFRNTD86IEhUTUxFbGVtZW50IC8vIHVuaWZ5IG1heWJlIHdpdGggY2xhc3MgSFRNTFJlcHJlc2VudGFibGVcbn1cblxuYWJzdHJhY3QgY2xhc3MgSFRNTFJlcHJlc2VudGFibGUge1xuXHRwcml2YXRlIF9IVE1MIDogSFRNTEVsZW1lbnRcblxuXHRzZXQgSFRNTCAoSFRNTDogSFRNTEVsZW1lbnQpIHtcblx0XHR0aGlzLl9IVE1MID0gSFRNTFxuXHR9XG5cblx0Z2V0IEhUTUwgKCkgOiBIVE1MRWxlbWVudCB7XG5cdFx0cmV0dXJuIHRoaXMuX0hUTUxcblx0fVxufVxuXG5jbGFzcyBGbG9vciBleHRlbmRzIEhUTUxSZXByZXNlbnRhYmxlIHtcblx0cHVibGljIHF1ZXVlOiBBcnJheTxQYXNzZW5nZXI+ID0gW11cblx0cHJpdmF0ZSBzdG9wUXVldWVGbGFnIDogYm9vbGVhbiA9IGZhbHNlXG5cdHB1YmxpYyBudW1iZXI6IG51bWJlclxuXHRwdWJsaWMgbWF4Rmxvb3I6IG51bWJlclxuXHRwcml2YXRlIHNlbGVjdG9yQ2xhc3M6IHN0cmluZyA9ICdmbG9vcidcblxuXHRjb25zdHJ1Y3RvciAobnVtYmVyOiBudW1iZXIsIG1heEZsb29yOiBudW1iZXIpIHtcblx0XHRzdXBlcigpXG5cdFx0dGhpcy5udW1iZXIgPSBudW1iZXJcblx0XHR0aGlzLm1heEZsb29yID0gbWF4Rmxvb3Jcblx0XHR0aGlzLmdlbmVyYXRlUXVldWUgPSB0aGlzLmdlbmVyYXRlUXVldWUuYmluZCh0aGlzKVxuXHRcdHRoaXMuYnVpbGRIVE1MKClcblx0XHR0aGlzLmVucXVldWVQYXNzZW5nZXIgPSB0aGlzLmVucXVldWVQYXNzZW5nZXIuYmluZCh0aGlzKVxuXHRcdHRoaXMuZ2V0UmFuZG9tUXVldWVyID0gdGhpcy5nZXRSYW5kb21RdWV1ZXIuYmluZCh0aGlzKVxuXHR9XG5cblx0c2V0UXVldWUgKG5ld1F1ZXVlOiBBcnJheTxQYXNzZW5nZXI+KSB7XG5cdFx0Ly8gY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkobmV3UXVldWUpKVxuXHRcdHRoaXMucXVldWUgPSBuZXdRdWV1ZVxuXHRcdHRoaXMuSFRNTC5pbm5lckhUTUwgPSAnJ1xuXHRcdHRoaXMucXVldWUubWFwKGkgPT4ge1xuXHRcdFx0Y29uc3QgbmV3UGFzc2VuZ2VySFRNTCA9IHRoaXMuZ2V0UGFzc2VuZ2VySFRNTChpLmJvdW5kVG8pXG5cdFx0XHR0aGlzLkhUTUwuYXBwZW5kQ2hpbGQobmV3UGFzc2VuZ2VySFRNTClcblx0XHR9KVxuXHR9XG5cblx0Z2VuZXJhdGVRdWV1ZSAoZWxldmF0b3JNYW5hZ2VyOiAoKSA9PiBFbGV2YXRvcikgeyAvLyBjcmVhdGUgYSB0eXBlLCB1c2UgYSB0eXBlIGluc3RlYWQgb2YgdGhpcyBhYm9taW5hdGlvblxuXHRcdGxldCB7IHF1ZXVlLCBzdG9wUXVldWVGbGFnLCBnZW5lcmF0ZVF1ZXVlLCBnZXRSYW5kb21RdWV1ZXIsIGVucXVldWVQYXNzZW5nZXIgfSA9IHRoaXNcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGVucXVldWVQYXNzZW5nZXIoZ2V0UmFuZG9tUXVldWVyKCksIGVsZXZhdG9yTWFuYWdlcilcblx0XHRcdGlmICghc3RvcFF1ZXVlRmxhZykge1xuXHRcdFx0XHRnZW5lcmF0ZVF1ZXVlKGVsZXZhdG9yTWFuYWdlcilcblx0XHRcdH1cblx0XHR9LCBNYXRoLnJhbmRvbSgpICogMjAwMDApXG5cdH1cblxuXHRkZXF1ZXVlUGFzc2VuZ2VyIChpOiBudW1iZXIpIHsgLy8gZ29ubmEgYmUgY2FsbGVkIGJ5IHRoZSBlbGV2YXRvciB1cG9uIGxvYWRcblx0XHR0aGlzLkhUTUwucmVtb3ZlQ2hpbGQodGhpcy5xdWV1ZVtpXS5IVE1MKVxuXHRcdHRoaXMucXVldWUuc3BsaWNlKGksMSlcblx0fVxuXG5cdGVucXVldWVQYXNzZW5nZXIgKHBhc3NlbmdlcjogUGFzc2VuZ2VyLCBlbGV2YXRvck1hbmFnZXI6ICgpID0+IEVsZXZhdG9yKSB7XG5cdFx0dGhpcy5xdWV1ZS5wdXNoKHBhc3Nlbmdlcilcblx0XHRwYXNzZW5nZXIuSFRNTCA9IHRoaXMuZ2V0UGFzc2VuZ2VySFRNTChwYXNzZW5nZXIuYm91bmRUbylcblx0XHR0aGlzLkhUTUwuYXBwZW5kQ2hpbGQocGFzc2VuZ2VyLkhUTUwpXG5cblx0XHRjb25zdCBlbGV2YXRvciA9IGVsZXZhdG9yTWFuYWdlcigpXG5cdFx0Ly8gY29uc29sZS5sb2cocGFzc2VuZ2VyLmJvdW5kVG8pXG5cdFx0ZWxldmF0b3IuY2FsbCh0aGlzLm51bWJlciwgcGFzc2VuZ2VyLmJvdW5kVG8pXG5cdH1cblxuXHRnZXRQYXNzZW5nZXJIVE1MIChib3VuZFRvOiBudW1iZXIpIHtcblx0XHRjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZCgncGFzc2VuZ2VyJylcblx0XHRlbC5pbm5lckhUTUwgPSA8c3RyaW5nPiA8dW5rbm93bj4gYm91bmRUbyAvLyBvbWcgd3RmIHR5cGUgY2FzdGluZyBpcyBjcmF6ZWVcblx0XHRyZXR1cm4gZWxcblx0fVxuXG5cdGdldFJhbmRvbVF1ZXVlciAoKSA6IFBhc3NlbmdlciB7XG5cdFx0Y29uc3QgYm91bmRUbyA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqICh0aGlzLm1heEZsb29yIC0gMSkpIC8vIGZsb29ycyBhcmUgaW5kZXhlZCBmcm9tIHplcm9cblx0XHRpZiAoYm91bmRUbyAhPT0gdGhpcy5udW1iZXIpIFxuXHRcdFx0cmV0dXJuIHsgYm91bmRUbyB9IC8vIGRlZmluZSBhbmQgb2J0YWluIGZsb29ycyByYW5nZSBmcm9tIHRoZSBlbnZpcm9ubWVudFxuXHRcdGVsc2Vcblx0XHRcdHJldHVybiB0aGlzLmdldFJhbmRvbVF1ZXVlcigpXG5cdFx0Ly8gcHJldmVudCBpZGlvdHMgdGhhdCB0cnkgdG8gZ28gb250byB0aGUgZmxvb3IgdGhleSBhbHJlYWR5IGFyZVxuXHR9XG5cblx0YnVpbGRIVE1MICgpIHtcblx0XHR0aGlzLkhUTUwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuXHRcdHRoaXMuSFRNTC5jbGFzc0xpc3QuYWRkKHRoaXMuc2VsZWN0b3JDbGFzcylcblx0XHR0aGlzLkhUTUwuaW5uZXJIVE1MID0gPHN0cmluZz4gPHVua25vd24+IHRoaXMubnVtYmVyXG5cdH1cbn1cblxuY2xhc3MgRWxldmF0b3IgZXh0ZW5kcyBIVE1MUmVwcmVzZW50YWJsZSB7XG5cdHByaXZhdGUgY2FwYWNpdHkgOiBudW1iZXIgPSA2XG5cdHByaXZhdGUgb2NjdXBhbnRzIDogQXJyYXk8UGFzc2VuZ2VyPiA9IFtdXG5cdHByaXZhdGUgc3BlZWQgOiBudW1iZXIgPSA5MDAgLy8gbXNcblx0Ly8gcHJpdmF0ZSBuZXh0Rmxvb3IgOiBudW1iZXIgPSAwIC8vIHJlc3RpbmcgYXQgZ3JvdW5kIGZsb29yXG5cdHByaXZhdGUgcXVldWUgOiBBcnJheTxBcnJheTxudW1iZXI+PiA9IFtdXG5cdHByaXZhdGUgbmV3UXVldWUgOiBBcnJheTxudW1iZXI+ID0gWzBdXG5cdHB1YmxpYyBjdXJyZW50Rmxvb3I6IG51bWJlciA9IDBcblx0cHJpdmF0ZSBidWlsZGluZzogQnVpbGRpbmdcblx0cHJpdmF0ZSBvbk1vdmU6IGJvb2xlYW4gPSBmYWxzZVxuXG5cdC8vIGdldCBvY2N1cGFudHMgKCkgOiBBcnJheTxQYXNzZW5nZXI+IHtcblx0Ly8gXHRyZXR1cm4gdGhpcy5fb2NjdXBhbnRzXG5cdC8vIH1cblxuXHQvLyBzZXQgb2NjdXBhbnRzIChpdGVtczogQXJyYXk8UGFzc2VuZ2VyPikgeyAvLyBzZXR0ZXIgYW5kIGdldHRlciBhcmUgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xuXHQvLyBcdGNvbnNvbGUubG9nKFsuLi5pdGVtc10pXG5cdC8vIFx0dGhpcy5fb2NjdXBhbnRzID0gaXRlbXNcblx0Ly8gfVxuXG5cdGNvbnN0cnVjdG9yIChidWlsZGluZzogQnVpbGRpbmcpIHtcblx0XHRzdXBlcigpXG5cdFx0dGhpcy5IVE1MID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jylcblx0XHR0aGlzLkhUTUwuY2xhc3NMaXN0LmFkZCgnZWxldmF0b3InKVxuXHRcdHRoaXMudXBvbkFycml2YWwgPSB0aGlzLnVwb25BcnJpdmFsLmJpbmQodGhpcylcblx0XHR0aGlzLmJ1aWxkaW5nID0gYnVpbGRpbmdcblxuXHRcdHRoaXMuSFRNTC5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgZSA9PiB7XG5cdFx0XHR0aGlzLnVwb25BcnJpdmFsKClcblx0XHR9KVxuXHR9XG5cblx0Z2V0IG5leHRGbG9vciAoKSB7XG5cdFx0Ly8gaWYgKHRoaXMucXVldWVbMF0gJiYgdGhpcy5xdWV1ZVswXVswXSlcblx0XHRpZiAodGhpcy5xdWV1ZVswXSAmJiB0eXBlb2YgdGhpcy5xdWV1ZVswXVswXSA9PT0gXCJudW1iZXJcIilcblx0XHRcdHJldHVybiB0aGlzLnF1ZXVlWzBdWzBdXG5cdH1cblxuXHRtb3ZlVG8gKGZsb29ySWQ6IG51bWJlcikgeyAvKiBnaXZlbiB0aGUgZmxpZ2h0cyBhcmUgaWRlbnRpY2FsICovXG5cdFx0bGV0IHsgc3BlZWQsIG5leHRGbG9vciB9ID0gdGhpc1xuXHRcdGNvbnN0IHRpbWUgPSBzcGVlZCAqIE1hdGguYWJzKHRoaXMuY3VycmVudEZsb29yIC0gZmxvb3JJZClcblx0XHRpZiAodGltZSA9PT0gMCkge1xuXHRcdFx0dGhpcy51cG9uQXJyaXZhbCgpXG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0dGhpcy5IVE1MLnN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9IHRpbWUgKyAnbXMnXG5cdFx0XHR0aGlzLkhUTUwuc3R5bGUuYm90dG9tID0gdGhpcy5IVE1MLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCAqIGZsb29ySWQgKyAncHgnXG5cdFx0fVxuXHRcdC8vIHRoaXMuSFRNTC5zdHlsZS5iYWNrZ3JvdW5kID0gJ3JlZCdcblx0XHQvLyBuZWV0IHRvIGFkZCB0aGUgZXZlbnQgb25seSBvbmNlXG5cdFx0aWYgKHRoaXMub25Nb3ZlID09PSBmYWxzZSkge1xuXHRcdFx0dGhpcy5vbk1vdmUgPSB0cnVlXG5cdFx0fSBcblx0fVxuXG5cdHVuTG9hZCAoY3VycmVudEZsb29yOiBudW1iZXIpIHtcblx0XHRjb25zdCB1bmxvYWRlZCA6IEFycmF5PFBhc3Nlbmdlcj4gPSBbXVxuXHRcdGxldCBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXHRcdHRoaXMub2NjdXBhbnRzID0gdGhpcy5vY2N1cGFudHMucmVkdWNlKChhY2MsIGkpID0+IHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKGkuSFRNTClcblx0XHRcdFxuXHRcdFx0aWYgKGkuYm91bmRUbyA9PT0gY3VycmVudEZsb29yKSB7XG5cdFx0XHRcdHVubG9hZGVkLnB1c2goaSlcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGFjYy5wdXNoKGkpXG5cdFx0XHRcdGZyYWcuYXBwZW5kQ2hpbGQoaS5IVE1MKVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGFjY1xuXHRcdH0sIFtdKVxuXHRcdC8vIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0nKVxuXHRcdHRoaXMuSFRNTC5pbm5lckhUTUwgPSAnJ1xuXHRcdHRoaXMuSFRNTC5hcHBlbmRDaGlsZChmcmFnKVxuXHRcdHJldHVybiB1bmxvYWRlZFxuXHRcdC8vIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHRoaXMub2NjdXBhbnRzKSlcblx0fVxuXG5cdGxvYWQgKHF1ZXVlOiBBcnJheTxQYXNzZW5nZXI+KSB7IC8vIEBUT0RPIExvYWQgb25seSB0aG9zZSB0aGF0IGdvIGludG8gdGhlIHJpZ2h0IGRpcmVjdGlvblxuXHRcdGNvbnN0IGZyZWVTcG90cyA9IHRoaXMuY2FwYWNpdHkgLSB0aGlzLm9jY3VwYW50cy5sZW5ndGhcblx0XHRjb25zdCBsb3NlcnMgOiBBcnJheTxQYXNzZW5nZXI+ID0gW11cblx0XHRsZXQgY29tZXJzID0gcXVldWUucmVkdWNlKChhY2MsIHBhc3NlbmdlcikgPT4ge1xuXHRcdFx0Ly8gY29uc29sZS5sb2coYWNjLmxlbmd0aCA8IGZyZWVTcG90cylcblx0XHRcdC8vIGNvbnNvbGUubG9nKHRoaXMucXVldWVbMF0uaW5kZXhPZihwYXNzZW5nZXIuYm91bmRUbykgPj0gMClcblx0XHRcdGlmIChhY2MubGVuZ3RoIDwgZnJlZVNwb3RzICYmIHRoaXMucXVldWVbMF0uaW5kZXhPZihwYXNzZW5nZXIuYm91bmRUbykgPj0gMCkge1xuXHRcdFx0XHRhY2MucHVzaChwYXNzZW5nZXIpXG5cdFx0XHRcdHRoaXMuSFRNTC5hcHBlbmRDaGlsZChwYXNzZW5nZXIuSFRNTClcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRsb3NlcnMucHVzaChwYXNzZW5nZXIpXG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gYWNjXG5cdFx0fSwgW10pXG5cdFx0dGhpcy5vY2N1cGFudHMgPSBbLi4udGhpcy5vY2N1cGFudHMsIC4uLmNvbWVyc11cblx0XHRyZXR1cm4gbG9zZXJzXG5cdH1cblxuXHR1cG9uQXJyaXZhbCAoKSB7XG5cdFx0Ly8gY29uc29sZS5sb2coJ3Vwb25BcnJpdmFsIENhbWUgV2l0aCcpXG5cdFx0Ly8gY29uc29sZS5sb2codGhpcy5vY2N1cGFudHMpXG5cblx0XHR0aGlzLmN1cnJlbnRGbG9vciA9IHRoaXMubmV4dEZsb29yIC8vIHNhdmluZyB0aGUgb25lIHdlIGdvIHRvIGFzIHRoZSBuZXh0IG9uXG5cdFx0Y29uc3QgZmxvb3IgPSB0aGlzLmJ1aWxkaW5nLmZsb29yc1t0aGlzLmN1cnJlbnRGbG9vcl1cblx0XHQvLyByZW1vdmUgdGhlIHVzZWQgZmxvb3IgZnJvbSB0aGUgcXVldWVcblx0XHR0aGlzLnF1ZXVlWzBdLnNoaWZ0KCkgLy8gdGhpcyBjaGFuZ2VzIHRoaXMubmV4dEZsb29yIHZhbHVlXG5cdFx0aWYgKCF0aGlzLnF1ZXVlWzBdLmxlbmd0aClcblx0XHRcdHRoaXMucXVldWUuc2hpZnQoKVxuXG5cdFx0Y29uc3QgdW5sb2FkZWQgPSB0aGlzLnVuTG9hZCh0aGlzLmN1cnJlbnRGbG9vcilcblxuXHRcdC8vIGNvbnNvbGUubG9nKFwidW5sb2FkZWQ6XCIpXG5cdFx0Ly8gY29uc29sZS5sb2codW5sb2FkZWQpXG5cblx0XHRpZiAodHlwZW9mIHRoaXMubmV4dEZsb29yICE9PSAnbnVtYmVyJykge1xuXHRcdFx0dGhpcy5vbk1vdmUgPSBmYWxzZVxuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXHRcdC8vIGdldCBmbG9vciBieSBJRCBoZXJlXG5cdFx0Y29uc3QgbG9zZXJzIDogQXJyYXk8UGFzc2VuZ2VyPiA9IHRoaXMubG9hZChmbG9vci5xdWV1ZSkgLy8gQFRPRE8gcGFzcyB0aG9zZSBiYWNrIG9uIHRoZSBmbG9vciAtPiBjYXJlZnVsIHdpdGggcmVmZXJlbmNpbmdcblx0XHRcblx0XHRmbG9vci5zZXRRdWV1ZShsb3NlcnMpXG5cdFx0dGhpcy5tb3ZlVG8odGhpcy5uZXh0Rmxvb3IpXG5cdH1cblxuXHRjYWxsIChmcm9tOiBudW1iZXIsIHRvOiBudW1iZXIpIHtcblx0XHRsZXQgZGlyZWN0aW9uID0gZnJvbSA+IHRvXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnF1ZXVlLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgc3VicXVlID0gWy4uLnRoaXMucXVldWVbaV1dXG5cdFx0XHRpZihzdWJxdWVbMF0gPiBzdWJxdWVbMV0gPT09IGRpcmVjdGlvbikge1xuXHRcdFx0XHQvLyBjaGVjayBpZiBpdCdzIGZpcnN0IGFycmF5IGFuZCBtYWtlIGEgc3BlY2lhbCBjYXNlIFxuXHRcdFx0XHQvLyAtIGNoZWNrIGZpcnN0IGZsb29yIG51bWJlciBhbmQgY2hlY2sgaWYgdGhlIG5ldyBpdGVtIGlzIG5vdCBiZWhpbmQgb3VyIHZlY3RvciBzdGFydGluZyBwb2ludFxuXHRcdFx0XHRpZiAoaSA9PT0gMCAmJiAoZGlyZWN0aW9uID09PSBmYWxzZSAmJiBmcm9tIDwgc3VicXVlWzBdIHx8IGRpcmVjdGlvbiA9PT0gdHJ1ZSAmJiBmcm9tID4gc3VicXVlWzBdKSlcblx0XHRcdFx0XHRjb250aW51ZVxuXHRcdFx0XHRzdWJxdWUgPSBbLi4uc3VicXVlLCB0bywgZnJvbV1cblx0XHRcdFx0XHQucmVkdWNlKCAoYWNjLCBudW1iZXIpID0+IHtcblx0XHRcdFx0XHRcdGlmIChhY2MuaW5kZXhPZihudW1iZXIpIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRhY2MucHVzaChudW1iZXIpXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gYWNjXG5cdFx0XHRcdFx0fSwgW10pXG5cdFx0XHRcdFx0LnNvcnQoKVxuXG5cdFx0XHRcdGlmIChkaXJlY3Rpb24gPT09IHRydWUpIHtcblx0XHRcdFx0XHRzdWJxdWUgPSBzdWJxdWUucmV2ZXJzZSgpXG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5xdWV1ZVtpXSA9IHN1YnF1ZVxuXHRcdFx0XHRkaXJlY3Rpb24gPSB1bmRlZmluZWQgLy8gZmxhZ2dpbmcgdGhhdCB0aGUgaXRlbXMgaGF2ZSBiZWVuIGFsbG9jYXRlZFxuXHRcdFx0XHRicmVha1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoZGlyZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdHRoaXMucXVldWUucHVzaChbZnJvbSwgdG9dKVxuXHRcdH1cblx0XHRpZiAodGhpcy5vbk1vdmUgPT09IGZhbHNlKSB7XG5cdFx0XHR0aGlzLm1vdmVUbyh0aGlzLm5leHRGbG9vcilcblx0XHR9XG5cdH1cbn1cblxuY2xhc3MgQnVpbGRpbmcgZXh0ZW5kcyBIVE1MUmVwcmVzZW50YWJsZSB7XG5cdHB1YmxpYyBmbG9vcnMgOiBBcnJheTxGbG9vcj4gPSBbXVxuXHRwcml2YXRlIGVsZXZhdG9yIDogRWxldmF0b3Jcblx0cHJpdmF0ZSBjb250YWluZXIgOiBIVE1MRWxlbWVudFxuXG5cdGVsZXZhdG9yTWFuYWdlciAoKSA6IEVsZXZhdG9yIHtcblx0XHRyZXR1cm4gdGhpcy5lbGV2YXRvclxuXHR9XG5cblx0Y29uc3RydWN0b3IgKHsgZmxvb3JzQ291bnQsIGNvbnRhaW5lciB9IDogYW55KSB7XG5cdFx0c3VwZXIoKVxuXG5cdFx0Ly8gWy4uLkFycmF5KGZsb29yc0NvdW50KV0gLS0+IHR5cGVzY3JpcHQgc2hpdHMgcGFudHMgb24gdGhhdCBvbmVcblx0XHQvLyBBbHNvIC0+IGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTYzMjVcblx0XG5cdFx0bGV0IGQgOiBBcnJheTxOdW1iZXI+ID0gbmV3IEFycmF5KGZsb29yc0NvdW50KVxuXHRcdGQuZmlsbCgwKS5tYXAoKG8saSkgPT4ge1xuXHRcdFx0dGhpcy5mbG9vcnMucHVzaChuZXcgRmxvb3IoaSwgZC5sZW5ndGgpKVxuXHRcdH0pXG5cblx0XHR0aGlzLmVsZXZhdG9yID0gbmV3IEVsZXZhdG9yKHRoaXMpXG5cdFx0dGhpcy5jb250YWluZXIgPSBjb250YWluZXJcblxuXHRcdHRoaXMuZWxldmF0b3JNYW5hZ2VyID0gdGhpcy5lbGV2YXRvck1hbmFnZXIuYmluZCh0aGlzKVxuXG5cdFx0dGhpcy5idWlsZCgpXG5cdFx0dGhpcy5kZXBsb3koKVxuXHR9XG5cblx0YnVpbGQgKCkge1xuXHRcdHRoaXMuSFRNTCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG5cdFx0dGhpcy5IVE1MLmNsYXNzTGlzdC5hZGQoJ2J1aWxkaW5nJylcblx0XHR0aGlzLkhUTUwuaWQgPSAnYnVpbGRpbmcnXG5cblx0XHR0aGlzLmZsb29ycy5tYXAoKGZsb29yKSA9PiB7XG5cdFx0XHRmbG9vci5nZW5lcmF0ZVF1ZXVlKHRoaXMuZWxldmF0b3JNYW5hZ2VyKVxuXHRcdFx0dGhpcy5IVE1MLmFwcGVuZENoaWxkKGZsb29yLkhUTUwpXG5cdFx0fSlcblxuXHRcdHRoaXMuSFRNTC5hcHBlbmRDaGlsZCh0aGlzLmVsZXZhdG9yLkhUTUwpXG5cdH1cblxuXHRkZXBsb3kgKCkge1xuXHRcdHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuSFRNTClcblx0fVxufVxuXG5jb25zdCBidWlsZGluZyA9IG5ldyBCdWlsZGluZyh7XG5cdGZsb29yc0NvdW50OiAxMCxcblx0Y29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRhaW5lclwiKVxufSk7XG5cbmJ1aWxkaW5nLmRlcGxveSgpXG5jb25zb2xlLmxvZyhidWlsZGluZylcblxuXG5cblxuXG5cblxuXG5cblxuIl0sInNvdXJjZVJvb3QiOiIifQ==